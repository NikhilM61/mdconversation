import fs from 'fs';
import path from 'path';

const projectsDir = path.resolve('public/projects');
const outFile = path.resolve('src/data/generatedGalleries.ts');

function isImage(file) {
  return /\.(jpe?g|png|webp|gif|svg)$/i.test(file);
}

if (!fs.existsSync(projectsDir)) {
  console.error('projects directory not found:', projectsDir);
  process.exit(1);
}

const dirs = fs.readdirSync(projectsDir, { withFileTypes: true }).filter(d => d.isDirectory()).map(d => d.name);
const galleries = {};

for (const dir of dirs) {
  const full = path.join(projectsDir, dir);
  const files = fs.readdirSync(full, { withFileTypes: true })
    .filter(f => f.isFile() && isImage(f.name))
    .map(f => f.name)
    .sort();
  if (files.length > 0) {
    galleries[dir] = files.map(f => `/projects/${dir}/${f}`);
  }
}

const content = `// This file is generated by scripts/generate-galleries.mjs â€” do not edit by hand.
export const generatedGalleries = ${JSON.stringify(galleries, null, 2)} as Record<string, string[]>;
`;

fs.mkdirSync(path.dirname(outFile), { recursive: true });
fs.writeFileSync(outFile, content, 'utf8');
console.log('Wrote', outFile);
